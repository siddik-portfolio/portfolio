<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Agri Pro - Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2E7D32;
            --secondary: #8BC34A;
            --bg: #F8F9FA;
            --card-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); display: flex; height: 100vh; overflow: hidden; }

        /* --- SIDEBAR (বামের অংশ) --- */
        .sidebar {
            width: 250px; background: white; border-right: 1px solid #eee;
            display: flex; flex-direction: column; padding: 30px 20px;
        }
        .sidebar-logo { display: flex; align-items: center; gap: 10px; color: var(--primary); font-size: 20px; font-weight: bold; margin-bottom: 50px; }
        .nav-item { 
            display: flex; align-items: center; gap: 15px; padding: 12px 15px; 
            border-radius: 12px; cursor: pointer; color: #666; transition: 0.3s; margin-bottom: 5px; text-decoration: none;
        }
        .nav-item.active { background: var(--primary); color: white; }
        .nav-item:hover:not(.active) { background: #f0f0f0; }

        /* --- MAIN CONTENT (ডানের অংশ) --- */
        .main-panel { flex: 1; overflow-y: auto; padding: 30px; }
        
        /* Top Status Cards */
        .top-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-box { background: white; padding: 20px; border-radius: 18px; box-shadow: var(--card-shadow); display: flex; align-items: center; gap: 15px; }
        .stat-box i { font-size: 24px; color: var(--primary); opacity: 0.8; }
        .stat-info p { font-size: 12px; color: #888; }
        .stat-info h3 { font-size: 16px; color: #333; }

        /* Middle Section: Map and AI */
        .content-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 25px; }

        /* Land Card with Map */
        .map-section { background: white; border-radius: 20px; padding: 20px; box-shadow: var(--card-shadow); }
        .map-header { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .map-placeholder { 
            width: 100%; height: 300px; background: #e0e0e0; border-radius: 15px; 
            background-image: url('https://img.freepik.com/free-vector/aerial-view-farmland-scene_1308-51347.jpg'); 
            background-size: cover; position: relative;
        }

        /* AI Side Panel */
        .ai-panel { background: white; border-radius: 20px; padding: 20px; box-shadow: var(--card-shadow); display: flex; flex-direction: column; }
        .ai-btn { background: var(--primary); color: white; padding: 15px; border-radius: 12px; text-align: center; font-weight: bold; text-decoration: none; margin-top: 15px; }
        
        /* Land List Footer */
        .land-footer { margin-top: 30px; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .mini-card { background: white; padding: 15px; border-radius: 15px; box-shadow: var(--card-shadow); border-left: 5px solid var(--primary); position: relative; }
        
        .service-btns { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .s-btn { border: none; padding: 8px; border-radius: 10px; font-size: 10px; cursor: pointer; text-align: center; }
        .s-btn i { display: block; font-size: 14px; margin-bottom: 4px; }

        .btn-drone { background: #E8F5E9; color: var(--primary); }
        .btn-harvest { background: #FFF3E0; color: #E65100; }
        .btn-pump { background: #E3F2FD; color: #1565C0; }

        .del-btn { position: absolute; top: 10px; right: 10px; color: #ddd; cursor: pointer; border: none; background: none; }
        .del-btn:hover { color: #f44336; }

        @media (max-width: 900px) {
            body { flex-direction: column; overflow-y: auto; }
            .sidebar { width: 100%; height: auto; flex-direction: row; overflow-x: auto; padding: 15px; }
            .sidebar-logo, .nav-item span { display: none; }
            .content-grid { grid-template-columns: 1fr; }
            .top-stats { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-logo"><i class="fas fa-leaf"></i> Agri Pro</div>
        <a href="#" class="nav-item active"><i class="fas fa-th-large"></i> <span>Dashboard</span></a>
        <a href="map.html" class="nav-item"><i class="fas fa-map"></i> <span>My Lands</span></a>
        <a href="scanner.html" class="nav-item"><i class="fas fa-robot"></i> <span>AI Scanner</span></a>
        <a href="#" class="nav-item"><i class="fas fa-user"></i> <span>Profile</span></a>
        <div style="flex:1"></div>
        <div class="nav-item" onclick="logout()" style="color:#f44336"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></div>
    </div>

    <div class="main-panel">
        
        <div class="top-stats">
            <div class="stat-box">
                <i class="fas fa-cloud-sun"></i>
                <div class="stat-info"><p>আবহাওয়া</p><h3 id="weather">লোড হচ্ছে...</h3></div>
            </div>
            <div class="stat-box">
                <i class="fas fa-plane-departure"></i>
                <div class="stat-info"><p>ড্রোন সার্ভিস</p><h3>সক্রিয়</h3></div>
            </div>
            <div class="stat-box">
                <i class="fas fa-seedling"></i>
                <div class="stat-info"><p>মাটির স্বাস্থ্য</p><h3>৭৪% (ভালো)</h3></div>
            </div>
            <div class="stat-box">
                <i class="fas fa-coins"></i>
                <div class="stat-info"><p>ধানের বাজার দর</p><h3>১২৫০৳</h3></div>
            </div>
        </div>

        <div class="content-grid">
            <div class="map-section">
                <div class="map-header">
                    <h2 id="display-name">লোড হচ্ছে...</h2>
                    <a href="map.html?mode=add" style="color:var(--primary); text-decoration:none; font-weight:bold">+ জমি যোগ করুন</a>
                </div>
                <div class="map-placeholder">
                    </div>
            </div>

            <div class="ai-panel">
                <h3>AI বিশেষজ্ঞ</h3>
                <div style="margin:20px 0; font-size:14px; color:#666">
                    <p>আপনার ফসলের ছবি তুলে রোগ শনাক্ত করুন এবং সমাধান জানুন মুহূর্তেই।</p>
                </div>
                <a href="scanner.html" class="ai-btn"><i class="fas fa-camera"></i> স্ক্যান শুরু করুন</a>
                <div style="margin-top:20px; font-size:12px; color:#888; border-top:1px solid #eee; padding-top:10px">
                    হেল্পলাইন: +৮৮০ ১৭...
                </div>
            </div>
        </div>

        <h3 style="margin: 30px 0 15px;">আপনার নিবন্ধিত জমিসমূহ</h3>
        <div class="land-footer" id="land-list">
            </div>

    </div>

    <script type="module">
        import { auth, db } from './firebase-config.js';
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { doc, getDoc, collection, query, where, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    document.getElementById('display-name').innerText = "হ্যালো, " + (userDoc.data().fullName || "কৃষক বন্ধু");
                }
                document.getElementById('weather').innerText = "২৯°C পরিষ্কার";
                renderLands(user.uid);
            } else { window.location.href = 'index.html'; }
        });

        async function renderLands(uid) {
            const container = document.getElementById('land-list');
            container.innerHTML = "লোড হচ্ছে...";
            const q = query(collection(db, "lands"), where("userId", "==", uid));
            const querySnapshot = await getDocs(q);
            
            if (querySnapshot.empty) {
                container.innerHTML = "কোনো জমি পাওয়া যায়নি।";
                return;
            }

            let html = "";
            querySnapshot.forEach((docSnap) => {
                const land = docSnap.data();
                html += `
                    <div class="mini-card">
                        <button class="del-btn" onclick="deleteLand('${docSnap.id}')"><i class="fas fa-times-circle"></i></button>
                        <strong style="display:block; margin-bottom:5px;">${land.name}</strong>
                        <small color="#777"><i class="fas fa-expand"></i> ${land.area} শতাংশ</small>
                        <div class="service-btns">
                            <button class="s-btn btn-drone" onclick="orderService('ড্রোন', '${land.name}')"><i class="fas fa-plane"></i>ড্রোন</button>
                            <button class="s-btn btn-harvest" onclick="orderService('কাটাই', '${land.name}')"><i class="fas fa-tractor"></i>কাটাই</button>
                            <button class="s-btn btn-pump" onclick="orderService('পাম্প', '${land.name}')"><i class="fas fa-water"></i>পাম্প</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        window.logout = () => { if(confirm("Log out?")) signOut(auth).then(()=> location.href='index.html'); }
        window.orderService = (s, l) => alert("অর্ডার হয়েছে: " + s + " (" + l + ")");
        window.deleteLand = async (id) => { if(confirm("মুছে ফেলবেন?")) { await deleteDoc(doc(db, "lands", id)); location.reload(); } }
    </script>
</body>
</html>
